<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Advanced Encode/Decode (PWA)</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#0f62fe" />

  <style>
    /* Minimal UI (you can split to style.css) */
    :root{
      --primary:#0f62fe;
      --bg:#f5f7fb;
      --card:#fff;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family:Arial, Helvetica, sans-serif;
      background:var(--bg);
      color:#111;
      line-height:1.5;
    }
    .container{
      max-width:700px;
      margin:18px auto;
      padding:16px;
      background:var(--card);
      border-radius:14px;
      box-shadow:0 4px 18px rgba(8,20,66,0.08);
    }
    h1{
      margin:0 0 14px;
      font-size:20px;
      font-weight:600;
    }
    textarea{
      width:100%;
      min-height:160px;
      padding:14px;
      border-radius:10px;
      border:1px solid #dbe4f2;
      font-size:15px;
      resize:vertical;
    }
    .row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-top:10px;
    }
    button{
      background:var(--primary);
      color:#fff;
      padding:10px 12px;
      border:0;
      border-radius:8px;
      cursor:pointer;
      font-size:14px;
      transition:0.15s;
    }
    button:hover{
      opacity:.85;
      transform:translateY(-1px);
    }
    button:active{
      transform:translateY(0px);
      opacity:.95;
    }
    .result{
      margin-top:12px;
      background:#f1f5ff;
      padding:12px;
      border-radius:8px;
      min-height:100px;
      white-space:pre-wrap;
      overflow:auto;
      font-family:ui-monospace, monospace;
      border:1px solid #e0e8ff;
    }
    .controls{
      display:flex;
      gap:8px;
      margin-top:10px;
      flex-wrap:wrap;
    }
    .small{
      background:#e6eef8;
      color:#024;
      padding:8px 10px;
      border-radius:6px;
      font-size:13px;
    }

    /* Mobile Optimized Buttons */
    @media(max-width:520px){
      button{
        flex:1 1 48%;
      }
    }
    footer {
      margin-top: auto;
      text-align:center;
      padding:12px;
      font-size:12px;
      opacity:.6;
    }

    /* Install Button Style */
    #installBtn {
      display: none;
      margin-top: 12px;
      padding: 10px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background: var(--primary);
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <h1>Advanced Encode / Decode — Offline PWA</h1>

    <textarea id="input" placeholder="Enter text here..."></textarea>

    <div class="row">
      <button onclick="base64Encode()">Base64 Encode</button>
      <button onclick="base64Decode()">Base64 Decode</button>
      <button onclick="urlEncode()">URL Encode</button>
      <button onclick="urlDecode()">URL Decode</button>
      <button onclick="md5Hash()">MD5 Hash</button>
      <button onclick="sha256Hash()">SHA256</button>
      <button onclick="toUpperCaseText()">UPPER</button>
      <button onclick="toLowerCaseText()">lower</button>
    </div>

    <div class="controls">
      <button onclick="selectAndCopyOutput()">Select & Copy</button>
      <button onclick="clearAll()">Clear All</button>
      <div class="small">Offline ready — Install to home screen (PWA)</div>
    </div>

    <!-- Install Button -->
    <button id="installBtn">Install App</button>

    <div id="output" class="result" tabindex="0" aria-live="polite"></div>
  </div>

  <script>
    // --- helpers
    const $ = id => document.getElementById(id);
    function getInput(){ return $("input") ? $("input").value : $("input") ; }
    function getInputText(){ return document.getElementById("input").value; }
    function setOutput(data){ document.getElementById("output").innerText = data; }

    // --- Core features
    function base64Encode(){ try{ setOutput(btoa(getInputText())); }catch(e){ setOutput("❌ Cannot encode (binary/invalid chars)"); } }
    function base64Decode(){ try{ setOutput(atob(getInputText())); }catch(e){ setOutput("❌ Invalid Base64"); } }
    function urlEncode(){ setOutput(encodeURIComponent(getInputText())); }
    function urlDecode(){ try{ setOutput(decodeURIComponent(getInputText())); }catch(e){ setOutput("❌ Invalid URL encoding"); } }

    // MD5 (small embedded routine)
    function hex_md5(a){return rstr2hex(rstr_md5(str2rstr_utf8(a)))} /* md5 lib below (minified) */
    function md5Hash(){ setOutput(hex_md5(getInputText())); }

    async function sha256Hash(){
      try{
        const msg = new TextEncoder().encode(getInputText());
        const hashBuffer = await crypto.subtle.digest("SHA-256", msg);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2,"0")).join("");
        setOutput(hashHex);
      }catch(e){ setOutput("❌ SHA256 failed"); }
    }

    function toUpperCaseText(){ setOutput(getInputText().toUpperCase()); }
    function toLowerCaseText(){ setOutput(getInputText().toLowerCase()); }

    // Select + copy
    function selectAndCopyOutput(){
      const out = document.getElementById("output");
      if(!out) return;
      const range = document.createRange();
      range.selectNodeContents(out);
      const sel = window.getSelection();
      sel.removeAllRanges();
      sel.addRange(range);
      try{
        document.execCommand('copy');
        // small visual feedback
        const prev = out.innerText;
        out.innerText = "✅ Copied to clipboard";
        setTimeout(()=> out.innerText = prev, 900);
      }catch(e){
        if(navigator.clipboard){
          navigator.clipboard.writeText(out.innerText).then(()=>{
            const prev = out.innerText;
            out.innerText = "✅ Copied to clipboard";
            setTimeout(()=> out.innerText = prev, 900);
          }).catch(()=> alert("Copy failed"));
        }else alert("Copy failed");
      }
    }

    // Clear all
    function clearAll(){
      document.getElementById("input").value = "";
      document.getElementById("output").innerText = "";
      if(window.getSelection) window.getSelection().removeAllRanges();
    }

    // --- small MD5 implementation (minified included)
    var hexcase=0;
    function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),8*a.length))}
    function rstr2hex(c){for(var d,b="",a=c.length,e=0;e<a;e++)d=c.charCodeAt(e),b+="0123456789abcdef".charAt(d>>>4&15)+"0123456789abcdef".charAt(d&15);return b}
    function str2rstr_utf8(c){for(var d,b,a="",e=-1;++e<c.length;){d=c.charCodeAt(e);b=e+1<c.length?c.charCodeAt(e+1):0;55296<=d&&56319>=d&&56320<=b&&57343>=b&&(d=65536+((d&1023)<<10)+(b&1023),e++);128>d?a+=String.fromCharCode(d):(2048>d?a+=String.fromCharCode(192|d>>>6,128|d&63):55296<=d&&57343>=d?(a+=String.fromCharCode(240|d>>>18,128|d>>>12&63,128|d>>>6&63,128|d&63)):(a+=String.fromCharCode(224|d>>>12,128|d>>>6&63,128|d&63)))}return a}
    function rstr2binl(b){for(var c=Array(b.length>>2),a=0;a<c.length;a++)c[a]=0;for(a=0;a<8*b.length;a+=8)c[a>>5]|=(255&b.charCodeAt(a/8))<<a%32;return c}
    function binl2rstr(b){for(var c="",a=0;a<32*b.length;a+=8)c+=String.fromCharCode(b[a>>5]>>>a%32&255);return c}
    function binl_md5(p,k){p[k>>5]|=128<<k%32;p[14+((k+64>>>9)<<4)]=k;for(var o=1732584193,q=-271733879,r=-1732584194,s=271733878,a=0;a<p.length;a+=16){var t=o,u=q,v=r,w=s;o=md5_ff(o,q,r,s,p[a+0],7,-680876936);s=md5_ff(s,o,q,r,p[a+1],12,-389564586);r=md5_ff(r,s,o,q,p[a+2],17,606105819);q=md5_ff(q,r,s,o,p[a+3],22,-1044525330);o=md5_ff(o,q,r,s,p[a+4],7,-176418897);s=md5_ff(s,o,q,r,p[a+5],12,1200080426);r=md5_ff(r,s,o,q,p[a+6],17,-1473231341);q=md5_ff(q,r,s,o,p[a+7],22,-45705983);o=md5_ff(o,q,r,s,p[a+8],7,1770035416);s=md5_ff(s,o,q,r,p[a+9],12,-1958414417);r=md5_ff(r,s,o,q,p[a+10],17,-42063);o=(o+t)|0;q=(q+u)|0;r=(r+v)|0;s=(s+w)|0}return[o,q,r,s]}
    function md5_cmn(h,e,d,c,a,f){return((h<<a)|(h>>>32-a))+e+(d^c^f)}
    function md5_ff(h,e,d,c,a,f,g){return md5_cmn(e&(d^c)^c,h,e,a,f,g)}
    function rstr_md5(a){return binl2rstr(binl_md5(rstr2binl(a),8*a.length))}

    // --- Register service worker for PWA
    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('./sw.js').catch(()=>{/* fail silently */});
    }

    // --- Install Prompt Handling
    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'inline-block';
    });

    installBtn.addEventListener('click', async () => {
      installBtn.style.display = 'none';
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const choiceResult = await deferredPrompt.userChoice;
      if (choiceResult.outcome === 'accepted') {
        console.log('User accepted the install prompt');
      } else {
        console.log('User dismissed the install prompt');
      }
      deferredPrompt = null;
    });
  </script>
  <footer>
    PWA Encode Tool — KMW
  </footer>
</body>
</html>
